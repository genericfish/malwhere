<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malwhere: Analysis</title>

    <style>
        html, body {
            background: black;
            color: white;

            font-family: 'Courier New', Courier, monospace;
        }

        .popup {
            position: fixed;
            background: black;
            border: 1px solid white;
        }

        .token.VariableToken {
            color: olive;
        }

        .token.FuncNameToken {
            color: goldenrod;
        }

        .token.TypeToken {
            color: cadetblue;
        }

        .token.OpToken {
            color: indianred;
        }

        .token.constant {
            color: orange;
        }

        .token.CommentToken {
            color: grey;
        }

    </style>
</head>
<body>
    <h1>{{ submission_id }}</h1>
    {% for fname, data in functions.items() %}
    <div id="{{ fname }}" class="function">
        <div class="info">
            <span class="name">{{ data["simpleName"] }}</span>
            <span class="address">{{ data["entry"] }}</span>
        </div>
        {% for token in data["tokens"] %}
        {% if token["type"] == "Break" %}
        <br>
        {% else %}
        <span
            class="token {{ token['type'] }} {% if 'constant' in token %}constant{% endif %}"
            {% if 'min_address' in token %}
            data-min-address="{{ token['min_address'] }}"
            {% endif %}
            {% if 'max_address' in token %}
            data-max-address="{{ token['max_address'] }}"
            {% endif %}
            {% if 'var_address' in token %}
            data-var-address="{{ token['var_address'] }}"
            {% endif %}
            {% if 'constant' in token %}
            data-constant="1"
            {% endif %}
        >{{ token["value"] }}</span>
        {% endif %}
        {% endfor %}
    </div>
    {% endfor %}

    <script>
        const functions = document.getElementsByClassName("function")
        const tokens = document.getElementsByClassName("token")

        const popup = document.createElement("div")
        popup.classList.add("popup")

        document.body.appendChild(popup)

        for (let token of tokens) {

            token.addEventListener("mouseover", event => {
                text = ""

                if (token.hasAttribute("data-min-address"))
                    text += `min-addr: 0x${token.getAttribute("data-min-address")}`

                if (token.hasAttribute("data-max-address"))
                    text += `\nmax-addr: 0x${token.getAttribute("data-max-address")}`

                if (token.hasAttribute("data-var-address"))
                    text += `\nvar-addr: 0x${token.getAttribute("data-var-address")}`

                if (token.hasAttribute("data-constant"))
                    text += `\nconstant`

                if (text.length == 0)
                    return

                popup.style.display = null
                popup.innerText = text

                bbox = token.getBoundingClientRect()
                pbbox = popup.getBoundingClientRect()
                popup.style.top = `${bbox.y - pbbox.height}px`
                popup.style.left = `${Math.max(1, bbox.x - pbbox.width / 2)}px`
            })
            token.addEventListener("mouseleave", _ => popup.style.display = "none")
        }
    </script>
</body>
</html>